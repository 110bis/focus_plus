{"ast":null,"code":"import _regeneratorRuntime from\"/home/qtreheux/Desktop/Focus_plus/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/home/qtreheux/Desktop/Focus_plus/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/home/qtreheux/Desktop/Focus_plus/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import React,{useState,useEffect}from'react';import download from'downloadjs';import axios from'axios';import{API_URL}from'../utils/constants';var FilesList=function FilesList(){var _useState=useState([]),_useState2=_slicedToArray(_useState,2),filesList=_useState2[0],setFilesList=_useState2[1];var _useState3=useState(''),_useState4=_slicedToArray(_useState3,2),errorMsg=_useState4[0],setErrorMsg=_useState4[1];useEffect(function(){var getFilesList=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var _yield$axios$get,data;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;_context.next=3;return axios.get(\"\".concat(API_URL,\"/getAllFiles\"));case 3:_yield$axios$get=_context.sent;data=_yield$axios$get.data;setErrorMsg('');setFilesList(data);_context.next=12;break;case 9:_context.prev=9;_context.t0=_context[\"catch\"](0);_context.t0.response&&setErrorMsg(_context.t0.response.data);case 12:case\"end\":return _context.stop();}}},_callee,null,[[0,9]]);}));return function getFilesList(){return _ref.apply(this,arguments);};}();getFilesList();},[]);var downloadFile=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(id,path,mimetype){var result,split,filename;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.prev=0;_context2.next=3;return axios.get(\"\".concat(API_URL,\"/download/\").concat(id),{responseType:'blob'});case 3:result=_context2.sent;split=path.split('/');filename=split[split.length-1];setErrorMsg('');return _context2.abrupt(\"return\",download(result.data,filename,mimetype));case 10:_context2.prev=10;_context2.t0=_context2[\"catch\"](0);if(_context2.t0.response&&_context2.t0.response.status===400){setErrorMsg('Erreur pendant le téléchargement. Réessayer plus tard.');}case 13:case\"end\":return _context2.stop();}}},_callee2,null,[[0,10]]);}));return function downloadFile(_x,_x2,_x3){return _ref2.apply(this,arguments);};}();return/*#__PURE__*/_jsxs(\"div\",{className:\"files-container\",children:[errorMsg&&/*#__PURE__*/_jsx(\"p\",{className:\"errorMsg\",children:errorMsg}),/*#__PURE__*/_jsxs(\"table\",{className:\"files-table\",children:[/*#__PURE__*/_jsx(\"thead\",{children:/*#__PURE__*/_jsx(\"tr\",{children:/*#__PURE__*/_jsx(\"th\",{children:\"Vos images sont disponibles\"})})}),/*#__PURE__*/_jsx(\"tbody\",{children:filesList.length>0?filesList.map(function(_ref3){var _id=_ref3._id,file_path=_ref3.file_path,file_mimetype=_ref3.file_mimetype;return/*#__PURE__*/_jsx(\"tr\",{children:/*#__PURE__*/_jsx(\"td\",{children:/*#__PURE__*/_jsx(\"a\",{href:\"#/\",onClick:function onClick(){return downloadFile(_id,file_path,file_mimetype);},children:\"T\\xE9l\\xE9charger\"})})},_id);}):/*#__PURE__*/_jsx(\"tr\",{children:/*#__PURE__*/_jsx(\"td\",{colSpan:3,style:{fontWeight:'300'},children:\"Pas d'image g\\xE9n\\xE9r\\xE9e trouv\\xE9e.\"})})})]})]});};export default FilesList;","map":{"version":3,"sources":["/home/qtreheux/Desktop/Focus_plus/src/components/FileList.js"],"names":["React","useState","useEffect","download","axios","API_URL","FilesList","filesList","setFilesList","errorMsg","setErrorMsg","getFilesList","get","data","response","downloadFile","id","path","mimetype","responseType","result","split","filename","length","status","map","_id","file_path","file_mimetype","fontWeight"],"mappings":"ibAAA,MAAOA,CAAAA,KAAP,EAAgBC,QAAhB,CAA0BC,SAA1B,KAA2C,OAA3C,CACA,MAAOC,CAAAA,QAAP,KAAqB,YAArB,CACA,MAAOC,CAAAA,KAAP,KAAkB,OAAlB,CACA,OAASC,OAAT,KAAwB,oBAAxB,CAEA,GAAMC,CAAAA,SAAS,CAAG,QAAZA,CAAAA,SAAY,EAAM,eACcL,QAAQ,CAAC,EAAD,CADtB,wCACbM,SADa,eACFC,YADE,8BAEYP,QAAQ,CAAC,EAAD,CAFpB,yCAEbQ,QAFa,eAEHC,WAFG,eAIpBR,SAAS,CAAC,UAAM,CACd,GAAMS,CAAAA,YAAY,0FAAG,mMAEMP,CAAAA,KAAK,CAACQ,GAAN,WAAaP,OAAb,iBAFN,uCAETQ,IAFS,kBAETA,IAFS,CAGjBH,WAAW,CAAC,EAAD,CAAX,CACAF,YAAY,CAACK,IAAD,CAAZ,CAJiB,+EAMjB,YAAMC,QAAN,EAAkBJ,WAAW,CAAC,YAAMI,QAAN,CAAeD,IAAhB,CAA7B,CANiB,oEAAH,kBAAZF,CAAAA,YAAY,0CAAlB,CAUAA,YAAY,GACb,CAZQ,CAYN,EAZM,CAAT,CAcA,GAAMI,CAAAA,YAAY,2FAAG,kBAAOC,EAAP,CAAWC,IAAX,CAAiBC,QAAjB,wLAEId,CAAAA,KAAK,CAACQ,GAAN,WAAaP,OAAb,sBAAiCW,EAAjC,EAAuC,CAC1DG,YAAY,CAAE,MAD4C,CAAvC,CAFJ,QAEXC,MAFW,gBAKXC,KALW,CAKHJ,IAAI,CAACI,KAAL,CAAW,GAAX,CALG,CAMXC,QANW,CAMAD,KAAK,CAACA,KAAK,CAACE,MAAN,CAAe,CAAhB,CANL,CAOjBb,WAAW,CAAC,EAAD,CAAX,CAPiB,iCAQVP,QAAQ,CAACiB,MAAM,CAACP,IAAR,CAAcS,QAAd,CAAwBJ,QAAxB,CARE,+DAUjB,GAAI,aAAMJ,QAAN,EAAkB,aAAMA,QAAN,CAAeU,MAAf,GAA0B,GAAhD,CAAqD,CACnDd,WAAW,CAAC,wDAAD,CAAX,CACD,CAZgB,uEAAH,kBAAZK,CAAAA,YAAY,qDAAlB,CAgBA,mBACE,aAAK,SAAS,CAAC,iBAAf,WACGN,QAAQ,eAAI,UAAG,SAAS,CAAC,UAAb,UAAyBA,QAAzB,EADf,cAEE,eAAO,SAAS,CAAC,aAAjB,wBACE,oCACE,iCACE,mDADF,EADF,EADF,cAME,uBACGF,SAAS,CAACgB,MAAV,CAAmB,CAAnB,CACChB,SAAS,CAACkB,GAAV,CACE,mBAAGC,CAAAA,GAAH,OAAGA,GAAH,CAAQC,SAAR,OAAQA,SAAR,CAAmBC,aAAnB,OAAmBA,aAAnB,oBACE,iCACE,iCACE,UACE,IAAI,CAAC,IADP,CAEE,OAAO,CAAE,yBACPb,CAAAA,YAAY,CAACW,GAAD,CAAMC,SAAN,CAAiBC,aAAjB,CADL,EAFX,+BADF,EADF,EAASF,GAAT,CADF,EADF,CADD,cAkBC,iCACE,WAAI,OAAO,CAAE,CAAb,CAAgB,KAAK,CAAE,CAAEG,UAAU,CAAE,KAAd,CAAvB,sDADF,EAnBJ,EANF,GAFF,GADF,CAsCD,CAxEH,CA0EE,cAAevB,CAAAA,SAAf","sourcesContent":["import React, { useState, useEffect } from 'react';\nimport download from 'downloadjs';\nimport axios from 'axios';\nimport { API_URL } from '../utils/constants';\n\nconst FilesList = () => {\n    const [filesList, setFilesList] = useState([]);\n    const [errorMsg, setErrorMsg] = useState('');\n\n    useEffect(() => {\n      const getFilesList = async () => {\n        try {\n          const { data } = await axios.get(`${API_URL}/getAllFiles`);\n          setErrorMsg('');\n          setFilesList(data);\n        } catch (error) {\n          error.response && setErrorMsg(error.response.data);\n        }\n      };\n\n      getFilesList();\n    }, []);\n\n    const downloadFile = async (id, path, mimetype) => {\n      try {\n        const result = await axios.get(`${API_URL}/download/${id}`, {\n          responseType: 'blob'\n        });\n        const split = path.split('/');\n        const filename = split[split.length - 1];\n        setErrorMsg('');\n        return download(result.data, filename, mimetype);\n      } catch (error) {\n        if (error.response && error.response.status === 400) {\n          setErrorMsg('Erreur pendant le téléchargement. Réessayer plus tard.');\n        }\n      }\n    };\n    \n    return (\n      <div className=\"files-container\">\n        {errorMsg && <p className=\"errorMsg\">{errorMsg}</p>}\n        <table className=\"files-table\">\n          <thead>\n            <tr>\n              <th>Vos images sont disponibles</th>\n            </tr>\n          </thead>\n          <tbody>\n            {filesList.length > 0 ? (\n              filesList.map(\n                ({ _id, file_path, file_mimetype }) => (\n                  <tr key={_id}>\n                    <td>\n                      <a\n                        href=\"#/\"\n                        onClick={() =>\n                          downloadFile(_id, file_path, file_mimetype)\n                        }\n                      >\n                        Télécharger\n                      </a>\n                    </td>\n                  </tr>\n                )\n              )\n            ) : (\n              <tr>\n                <td colSpan={3} style={{ fontWeight: '300' }}>\n                  Pas d'image générée trouvée.\n                </td>\n              </tr>\n            )}\n          </tbody>\n        </table>\n      </div>\n    );\n  };\n\n  export default FilesList;"]},"metadata":{},"sourceType":"module"}